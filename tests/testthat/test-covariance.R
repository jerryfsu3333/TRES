context("Covariance matrix")

test_that("Covariance matrix", {
  data("bat")
  x <- bat$x
  y <- bat$y
  fit_1d1 <- TRR.fit(bat$x, bat$y, u = c(14,14), method = "1D")
  # expect_equal(fit_1d1$Gamma[[1]][1:5], c(-0.00014302,0.00068032,0.00039628,0.00031333,0.00006079))
  expect_equal(fit_1d1$M_list[[1]][1:5], c(0.3288800611837778,0.0068559492778251,-0.0999985178162761,-0.0900861667920602,0.0359492033540018), 1e-16)
  expect_equal(fit_1d1$U_list[[1]][1:5], c(0.0233600851919101,0.0003683074612309,-0.0077124832475057,-0.0070067234516545,0.0022313086456458), 1e-16)
  expect_equal(fit_1d1$W0_list[[1]][[1]][1:5], c(0.0019916035851673,-0.0006808296771030,-0.0009928202065522,-0.0008029470156978,0.0000252780783541), 1e-16)
  expect_equal(fit_1d1$test_out_list[[1]][[1]]$nrmX, 1)
  expect_equal(drop(fit_1d1$test_out_list[[1]][[1]]$f), -11.0112702876024411)
  expect_equal(fit_1d1$test_out_list[[1]][[1]]$g[1:5], c(6.5467815904918139,0.2391295768696464,-2.4984332588195102,-1.9312239505496627,0.6963569808495462), 1e-16)
  expect_equal(drop(fit_1d1$test_out_list[[1]][[1]]$dtX)[1:5], c(-6.5388151761511644,-0.2418528955780516,2.4944619779933110,1.9280121624868793,-0.6962558685361299), 1e-16)
  expect_equal(fit_1d1$test_out_list[[1]][[1]]$nrmG, 12.0760727114176039, 1e-16)
  expect_equal(fit_1d1$test_out_list[[1]][[1]]$XDiff_list[[1]], 0.0003019015976517, 1e-16)
  expect_equal(drop(fit_1d1$test_out_list[[1]][[1]]$FDiff_list[[1]]), 0.0015758104839648, 1e-16)
  expect_equal(fit_1d1$test_out_list[[1]][[1]]$Q_list[[1]], 1.8500000000000001, 1e-16)
  expect_equal(drop(fit_1d1$test_out_list[[1]][[1]]$Cval_list[[1]]), -11.0215013609240291, 1e-16)
  expect_equal(drop(fit_1d1$test_out_list[[1]][[1]]$X_list[[1]])[1:5], c(0.0006838366483016,-0.0007291981999533,-0.0004939256428093,-0.0004173428036331,-0.0001139729660080), 1e-16)
  expect_equal(fit_1d1$Gamma[[1]][1:5,1], c(0.00014302,-0.00068032,-0.00039628,-0.00031333,-0.00006079))
})

